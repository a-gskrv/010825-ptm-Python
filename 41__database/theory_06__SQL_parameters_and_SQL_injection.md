## Способы передачи значений в SQL‑запросы 

### 1. Вставка значений в f-string

```python
city_name = "Moscow"
query = f"SELECT * FROM city WHERE Name = '{city_name}'"
cursor.execute(query)
```

* Допустима ТОЛЬКО для динамических идентификаторов, например 
  * имён таблиц или столбцов.
* КАТЕГОРИЧЕСКИ НЕ рекомендуется для пользовательских данных 
  * (риск SQL‑инъекций, ошибки с кавычками).

---

## 2. Параметризованные запросы

### 2.1. Плейсхолдеры `%s` (тюпл)

```python
city_name = "Moscow"
query = "SELECT * FROM city WHERE Name = %s"
cursor.execute(query, (city_name,))  # Запятая для одиночного значения!!!
```

* Значение передаётся отдельно от SQL.
* Драйвер экранирует данные.
* Защита от SQL‑инъекций.

### 2.2. Именованные параметры (`%(name)s`)

```python
params = {"city": "Moscow"}
query = "SELECT * FROM city WHERE Name = %(city)s"
cursor.execute(query, params)
```

* Можно передавать несколько параметров по именам.
* Удобно и безопасно для сложных запросов.

---

## 3. Пример с несколькими параметрами

```python
params = {"pop": 1000000, "code": "RUS"}
query = """
SELECT Name
FROM city
WHERE Population > %(pop)s AND CountryCode = %(code)s
"""
cursor.execute(query, params)
```

* Порядок неважен, важны имена параметров.
* Безопасно и удобно для динамических значений.

---

### 4. SQL‑инъекции

#### Опасный вариант (данные напрямую)

```python
city_name = "' OR 1=1 --"
query = f"SELECT * FROM city WHERE Name = '{city_name}'"
cursor.execute(query)
```

* Ввод превращается в часть SQL‑кода.
* Может вернуть все строки или удалить данные.

### Безопасный вариант (параметризованные запросы)

```python
params = {"city": "' OR 1=1 --"}
query = "SELECT * FROM city WHERE Name = %(city)s"
cursor.execute(query, params)
```

* Ввод обрабатывается как обычная строка.
* SQL‑код не изменяется.

---

### 5. Динамические имена таблиц и столбцов

```python
table_name = "city"
query = f"SELECT * FROM {table_name} WHERE Population > %s"
cursor.execute(query, (1000000,))
```

* **Идентификаторы не могут быть параметризованы**, 
  * поэтому для них используется f-string или `.format()`.
* Данные передаются через параметры, чтобы оставаться безопасными.

---

### Итог

| Способ                      | Где безопасно         | Рекомендация                           |
| --------------------------- | --------------------- | -------------------------------------- |
| f-string / % форматирование | Имена таблиц/столбцов | ✅ Можно, но только для идентификаторов |
| Прямое вставление данных    | ❌ Нет                 | ❌ Никогда для пользовательских данных  |
| Параметризованные (%s)      | ✅ Да                  | ✅ Всегда для данных                    |
| Именованные параметры       | ✅ Да                  | ✅ Удобно для нескольких данных         |
